<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3d: Dependent Data Descriptions for Verified Validation &mdash; EverParse Manual  documentation</title><link rel="stylesheet" href="static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="static/js/html5shiv.min.js"></script>
  <![endif]-->
  
      <script>
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'en',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script src="static/jquery.js"></script>
        <script src="static/underscore.js"></script>
        <script src="static/doctools.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="3d-lang.html" />
    <link rel="prev" title="Verified efficient parsing for binary data formats" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            EverParse Manual
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">3d: Dependent Data Descriptions for Verified Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#formal-guarantees">Formal guarantees</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-and-install">Download and install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run">Run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-mode">Default mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alternate-mode-generating-a-makefile">Alternate mode: generating a Makefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alternate-mode-hash-checking">Alternate mode: hash checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alternate-mode-test-case-generation">Alternate mode: test case generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#options-for-z3-test">Options for <code class="docutils literal notranslate"><span class="pre">--z3_test</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-related-to-the-c-test-program">Options related to the C test program</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-related-to-z3-and-smt2">Options related to Z3 and SMT2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#branch-coverage-analysis">Branch coverage analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#alternate-mode-help-and-version">Alternate mode: help and version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#language-reference">Language Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#base-types">Base types</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#structs">Structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#constraints">Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#bitfields">Bitfields</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#constants-and-enumerations">Constants and Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#parameterized-data-types">Parameterized data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#tagged-unions-or-casetype">Tagged unions or <code class="docutils literal notranslate"><span class="pre">casetype</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#arrays">Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#actions">Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#alignment">Alignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#explicitly-checking-3d-types-for-correspondence-with-existing-c-types">Explicitly checking 3d types for correspondence with existing C types</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#generating-code-with-for-several-compile-time-configurations">Generating code with for several compile-time configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#validating-data-with-indirections-or-pointers">Validating Data with Indirections or Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#specialization-for-different-pointer-sizes">Specialization for Different Pointer Sizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#comments">Comments</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#adding-copyright-notices-to-produced-c-h-files">Adding copyright notices to produced .c/.h files</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#modular-structure-and-files">Modular structure and files</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#error-handling">Error handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#fully-worked-examples-tcp-segment-headers">Fully worked examples: TCP Segment Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#fully-worked-examples-elf-files">Fully worked examples: ELF files</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EverParse Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">3d: Dependent Data Descriptions for Verified Validation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <div class="section" id="d-dependent-data-descriptions-for-verified-validation">
<span id="d"></span><h1>3d: Dependent Data Descriptions for Verified Validation<a class="headerlink" href="#d-dependent-data-descriptions-for-verified-validation" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The documentation from this page covers the EverParse/3d releases
v2025.05.20 or later. Documentations for earlier versions may be
found in the Git history.</p>
</div>
<p>EverParse/3d lets you write a data format description and
automatically produces efficient data validation code formally
verified for memory-safety (absence of buffer overruns), functional
correctness (validation is correct wrt. your data format) and security
(absence of double memory fetches.) A gentle overview of formal
verification is available in the <a class="reference external" href="https://hacl-star.github.io/Overview.html#what-is-verified-software">documentation of EverCrypt</a>;
EverParse provides similar formal guarantees except
secret-independence.</p>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Write your data format description in the 3d language, as
<code class="docutils literal notranslate"><span class="pre">MyFile1.3d</span></code>, <code class="docutils literal notranslate"><span class="pre">MyFile2.3d</span></code>.</li>
<li>Give MyFile1.3d and MyFile2.3d to EverParse:<ul>
<li>with the Windows binary package: <code class="docutils literal notranslate"><span class="pre">everparse.cmd</span> <span class="pre">MyFile1.3d</span> <span class="pre">MyFile2.3d</span></code></li>
<li>with the Linux binary package: <code class="docutils literal notranslate"><span class="pre">everparse.sh</span> <span class="pre">MyFile1.3d</span> <span class="pre">MyFile2.3d</span></code></li>
<li>with the source tree: <code class="docutils literal notranslate"><span class="pre">bin/3d.exe</span> <span class="pre">--batch</span> <span class="pre">MyFile1.3d</span> <span class="pre">MyFile2.3d</span></code></li>
</ul>
</li>
</ol>
<p>Then, EverParse/3d produces:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">MyFile1.fsti</span></code>, <code class="docutils literal notranslate"><span class="pre">MyFile1.fst</span></code>: the verified F* specification
and Low* implementation of parsers and validators for your data
format from <code class="docutils literal notranslate"><span class="pre">MyFile1.3d</span></code>, and similarly for <code class="docutils literal notranslate"><span class="pre">MyFile2.3d</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MyFile1.c</span></code>, <code class="docutils literal notranslate"><span class="pre">MyFile1.h</span></code>: the verified C code generated from the verified
F* and Low* files, and similarly for <code class="docutils literal notranslate"><span class="pre">MyFile2.3d</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MyFile1Wrapper.c</span></code>, <code class="docutils literal notranslate"><span class="pre">MyFile1Wrapper.h</span></code>: an entrypoint API to call into the
verified C code, and similarly for <code class="docutils literal notranslate"><span class="pre">MyFile2.3d</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">EverParse.h</span></code>, <code class="docutils literal notranslate"><span class="pre">EverParseEndianness.h</span></code>: various EverParse
helpers for the implementation of verified validators, common to
<code class="docutils literal notranslate"><span class="pre">MyFile1.3d</span></code> and <code class="docutils literal notranslate"><span class="pre">MyFile2.3d</span></code></li>
</ul>
<ol class="arabic simple" start="3">
<li>Insert <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;MyFile1Wrapper.h&quot;</span></code> into any of your C
compilation units that need to call a validator from
<code class="docutils literal notranslate"><span class="pre">MyFile1.3d</span></code>, and similarly for <code class="docutils literal notranslate"><span class="pre">MyFile2.3d</span></code>.</li>
</ol>
<div class="section" id="formal-guarantees">
<h3>Formal guarantees<a class="headerlink" href="#formal-guarantees" title="Permalink to this headline">¶</a></h3>
<p>For each message type in the source data formats, the generated C code
provides a _validator_, a procedure to determine if a given input
array of bytes contains a valid representation of a message, with the
following properties:</p>
<ul class="simple">
<li><em>Memory safety</em>: The validator is <a class="reference external" href="http://www.pl-enthusiast.net/2014/07/21/memory-safety/">memory safe</a>, meaning it never
accesses memory out of bounds, accesses memory at an incompatible
type, uses memory after it has been freed, etc.</li>
<li><em>Arithmetic safety</em>: The validator has no integer overflows or underflows.</li>
<li><em>Double-fetch freedom</em>: The validator reads every byte in the input array at
most once, defending against certain kinds of
<a class="reference external" href="https://cwe.mitre.org/data/definitions/367.html">time-of-check/time-of-use</a> bugs.</li>
<li><em>Write footprint</em>: The validator does not modify the input array,
and only modifies memory as described by user-controlled imperative
actions that are explicit in the specification.</li>
<li><em>No heap allocation</em>: The validator does not allocate any memory on
the heap.</li>
<li><em>Functionally correct</em>: The validator accepts all input arrays that
contain valid representations of the message according to its
specification, rejecting all others.</li>
</ul>
</div>
</div>
<div class="section" id="download-and-install">
<h2>Download and install<a class="headerlink" href="#download-and-install" title="Permalink to this headline">¶</a></h2>
<p>We provide binary (x86_64 only) packages for Windows and Linux.</p>
<ol class="arabic simple">
<li>Download the binary package corresponding to your platform, from
the <a class="reference external" href="https://github.com/project-everest/everparse/releases">latest EverParse/3d release</a>.</li>
<li>Extract it (Windows: <code class="docutils literal notranslate"><span class="pre">unzip</span></code>; Linux: <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">xzf</span></code>) anywhere you
like. No need to configure it anyhow.</li>
</ol>
<p>Then, everything is contained in a <code class="docutils literal notranslate"><span class="pre">everparse</span></code> directory, whose
actual entrypoint executable is <code class="docutils literal notranslate"><span class="pre">everparse.cmd</span></code> (for Windows) or
<code class="docutils literal notranslate"><span class="pre">everparse.sh</span></code> (for Linux.)</p>
<p>Binary packages already contain all dependencies required by
EverParse, such as F*, KaRaMeL and z3, so no need to install anything
beforehand.</p>
<p>The Windows binary package contains a <a class="reference external" href="https://llvm.org/builds/">binary snapshot of clang-format</a> to pretty-print the produced <code class="docutils literal notranslate"><span class="pre">.c</span></code> and
<code class="docutils literal notranslate"><span class="pre">.h</span></code> files. On Linux, you may want to install clang-format (more
info at the <a class="reference external" href="https://releases.llvm.org/download.html">LLVM download page</a>), but this is optional.</p>
<p>The Windows binary package is fully native, in the sense that it does
not require any POSIX emulation layer such as Cygwin or WSL.</p>
</div>
<div class="section" id="run">
<h2>Run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h2>
<p>On Windows: <code class="docutils literal notranslate"><span class="pre">everparse.cmd</span></code> [options] input_files</p>
<p>On Linux: <code class="docutils literal notranslate"><span class="pre">everparse.sh</span></code> [options] input_files</p>
<p>From the source tree: <code class="docutils literal notranslate"><span class="pre">bin/3d.exe</span></code>. Caveat: in that case, no options
are toggled by default (not even <code class="docutils literal notranslate"><span class="pre">--batch</span></code> or <code class="docutils literal notranslate"><span class="pre">--clang_format</span></code>)
and you need to provide all options by hand.</p>
<p>Options are treated from left to right, with higher priority on
right-most options. Thus, any <code class="docutils literal notranslate"><span class="pre">--no_clang_format</span></code> will override any
occurrence of <code class="docutils literal notranslate"><span class="pre">--clang_format</span></code> or <code class="docutils literal notranslate"><span class="pre">--clang_format_executable</span></code> to
its left, and vice-versa.</p>
<p>You can provide one or more <code class="docutils literal notranslate"><span class="pre">input_files</span></code> to EverParse. Then,
<code class="docutils literal notranslate"><span class="pre">EverParse.h</span></code> and <code class="docutils literal notranslate"><span class="pre">EverParseEndianness.h</span></code> will be shared across
<code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files produced for all the <code class="docutils literal notranslate"><span class="pre">.3d</span></code> files that you
provided.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">EverParse input files must all bear the <code class="docutils literal notranslate"><span class="pre">.3d</span></code> file name extension,
and their names must start with a capital letter.</p>
</div>
<div class="section" id="default-mode">
<h3>Default mode<a class="headerlink" href="#default-mode" title="Permalink to this headline">¶</a></h3>
<p>In default mode, EverParse3d produces C code corresponding to
validators proven correct with respect to the 3d specification.</p>
<p>Options are treated from left to right:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--odir</span> <span class="pre">output_directory_name</span></code></p>
<p>Tell EverParse to write all files to the directory
<code class="docutils literal notranslate"><span class="pre">output_directory_name</span></code>. This directory must already exist
(EverParse will not create it.) The default is <code class="docutils literal notranslate"><span class="pre">.</span></code> (current
directory)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--batch</span></code></p>
<p>Verify the produced F* <code class="docutils literal notranslate"><span class="pre">.fst</span></code> and <code class="docutils literal notranslate"><span class="pre">.fsti</span></code> files and generate C
<code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files. This is toggled by default.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--no_batch</span></code></p>
<p>Do not verify the produced F* <code class="docutils literal notranslate"><span class="pre">.fst</span></code> and <code class="docutils literal notranslate"><span class="pre">.fsti</span></code> files or
generate C <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--clang_format</span></code></p>
<p>Call <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> on extracted .c/.h files. This option
automatically toggles <code class="docutils literal notranslate"><span class="pre">--batch</span></code>.</p>
<p>This is toggled by default on Windows, since the Windows binary
package contains a copy of clang-format. On Linux, this is toggled
by default only if <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> is reachable through the
<code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--no_clang_format</span></code></p>
<p>Do not call clang-format on extracted .c/.h files.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--clang_format_executable</span></code></p>
<p>Provide the path to clang-format if not reachable through <code class="docutils literal notranslate"><span class="pre">PATH</span></code>
(or to override the one provided in the Windows binary package.)
This option automatically toggles <code class="docutils literal notranslate"><span class="pre">--clang_format</span></code> and
<code class="docutils literal notranslate"><span class="pre">--batch</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--clang_format_use_custom_config</span></code></p>
<p>With <code class="docutils literal notranslate"><span class="pre">--clang_format</span></code>, skip copying the <code class="docutils literal notranslate"><span class="pre">.clang-format</span></code> file
from the EverParse distribution, and assume that there is already an
existing <code class="docutils literal notranslate"><span class="pre">.clang-format</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--cleanup</span></code></p>
<p>With <code class="docutils literal notranslate"><span class="pre">--batch</span></code>, remove all produced intermediate files other than
<code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h`</span> <span class="pre">files</span> <span class="pre">(thus:</span> <span class="pre">``.fst</span></code>, <code class="docutils literal notranslate"><span class="pre">.fsti</span></code>, <code class="docutils literal notranslate"><span class="pre">.checked</span></code>,
<code class="docutils literal notranslate"><span class="pre">.krml</span></code>)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--no_cleanup</span></code></p>
<p>Keep all produced intermediate files. This is toggled by default.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--skip_c_makefiles</span></code></p>
<p>Skip generating the default Makefiles produced by Karamel to compile
the produced C code.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--add_include</span> <span class="pre">&lt;myinclude.h&gt;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">--add_include</span> <span class="pre">&quot;myinclude.h&quot;</span></code></p>
<p>Prepend each produced C file with a <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;myinclude.h&gt;</span></code> or a
<code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;myinclude.h&quot;</span></code> C preprocessor directive.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">myfile.config</span></code></p>
<p>Use the specified JSON file <code class="docutils literal notranslate"><span class="pre">myfile.config</span></code> to declare
compile-time flags (see compile-time configuration in the 3D
language reference.)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--fstar</span> <span class="pre">path/to/fstar.exe</span></code></p>
<p>Allows to specify the location of the F* executable. The
<code class="docutils literal notranslate"><span class="pre">everparse.sh</span></code> / <code class="docutils literal notranslate"><span class="pre">everparse.cmd</span></code> script in the EverParse binary
package is already configured to use the F* executable provided in
the package. Otherwise, the default is to use the <code class="docutils literal notranslate"><span class="pre">fstar.exe</span></code>
found from the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--input_stream</span> <span class="pre">buffer|extern|static</span></code></p>
<p>Specifies the format of validator input buffers:</p>
<ul>
<li><p class="first">With <code class="docutils literal notranslate"><span class="pre">buffer</span></code> (which is the default), a validator takes as
argument a byte array and its length.</p>
</li>
<li><p class="first">With <code class="docutils literal notranslate"><span class="pre">extern</span></code>, a validator takes as argument a value of a
user-defined <code class="docutils literal notranslate"><span class="pre">EVERPARSE_INPUT_STREAM_BASE</span></code> type, representing an
input byte stream, for which the following functions need to be
defined:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="n">BOOLEAN</span><span class="w"> </span><span class="nf">EverParseHas</span><span class="p">(</span>
<span class="w">  </span><span class="n">EVERPARSE_EXTRA_T</span><span class="w"> </span><span class="n">_extra_t</span><span class="p">,</span>
<span class="w">  </span><span class="n">EVERPARSE_INPUT_STREAM_BASE</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">n</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">EverParseHas</span></code> returns <code class="docutils literal notranslate"><span class="pre">1</span></code> if the input stream <code class="docutils literal notranslate"><span class="pre">x</span></code> has <code class="docutils literal notranslate"><span class="pre">n</span></code>
bytes available to read, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="nf">EverParseRead</span><span class="p">(</span>
<span class="w">  </span><span class="n">EVERPARSE_EXTRA_T</span><span class="w"> </span><span class="n">_extra_t</span><span class="p">,</span>
<span class="w">  </span><span class="n">EVERPARSE_INPUT_STREAM_BASE</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">EverParseRead</span></code> takes and reads <code class="docutils literal notranslate"><span class="pre">n</span></code> bytes from the input
stream <code class="docutils literal notranslate"><span class="pre">x</span></code>, possibly copying them into <code class="docutils literal notranslate"><span class="pre">dst</span></code>, and returns a
byte array containing the bytes read. There is no requirement that
the function returns <code class="docutils literal notranslate"><span class="pre">dst</span></code>, or even that a copy to <code class="docutils literal notranslate"><span class="pre">dst</span></code> is
made.  `</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">EverParseSkip</span><span class="p">(</span>
<span class="w">  </span><span class="n">EVERPARSE_EXTRA_T</span><span class="w"> </span><span class="n">_extra_t</span><span class="p">,</span>
<span class="w">  </span><span class="n">EVERPARSE_INPUT_STREAM_BASE</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">n</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">EverParseSkip</span></code> advances the input stream <code class="docutils literal notranslate"><span class="pre">x</span></code> by <code class="docutils literal notranslate"><span class="pre">n</span></code> bytes
without reading them.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="nf">EverParsePeep</span><span class="p">(</span>
<span class="w">  </span><span class="n">EVERPARSE_EXTRA_T</span><span class="w"> </span><span class="n">_extra_t</span><span class="p">,</span>
<span class="w">  </span><span class="n">EVERPARSE_INPUT_STREAM_BASE</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">n</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">EverParsePeep</span></code> returns a pointer to a byte array that is part
of the input stream <code class="docutils literal notranslate"><span class="pre">x</span></code> and points to its next <code class="docutils literal notranslate"><span class="pre">n</span></code> bytes, then
advances the input stream by <code class="docutils literal notranslate"><span class="pre">n</span></code>. If such operation is
impossible, then returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Such a pointer is returned by
the <code class="docutils literal notranslate"><span class="pre">field_ptr</span></code> action (see “Atomic actions” in the 3d language
reference), so it is the responsibility of the application to
ensure double-fetch freedom on the contents of the returned field
is preserved.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="nf">EverParseEmpty</span><span class="p">(</span>
<span class="w">  </span><span class="n">EVERPARSE_EXTRA_T</span><span class="w"> </span><span class="n">_extra_t</span><span class="p">,</span>
<span class="w">  </span><span class="n">EVERPARSE_INPUT_STREAM_BASE</span><span class="w"> </span><span class="n">x</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">EverParseEmpty</span></code> skips to the end of the input stream <code class="docutils literal notranslate"><span class="pre">x</span></code> and
returns the number of bytes so skipped, without reading them.</p>
<p>In all such functions, <code class="docutils literal notranslate"><span class="pre">EVERPARSE_EXTRA_T</span></code> is a user-defined
type for the context used for error handling (see “Error handling”
in the 3d language reference.)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">static</span></code> is like <code class="docutils literal notranslate"><span class="pre">extern</span></code> except that the functions on
<code class="docutils literal notranslate"><span class="pre">EVERPARSE_INPUT_STREAM_BASE</span></code> are declared <code class="docutils literal notranslate"><span class="pre">static</span></code>.</p>
</li>
</ul>
<p>In any case, to compile the C code produced by EverParse, you need
to add to the include path the subdirectory
<code class="docutils literal notranslate"><span class="pre">src/3d/prelude/&lt;input_stream_format&gt;</span></code> of the EverParse binary
package or repository; this directory contains the <code class="docutils literal notranslate"><span class="pre">EverParse.h</span></code>
corresponding to the input stream format given by <code class="docutils literal notranslate"><span class="pre">--input_stream</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--input_stream_include</span> <span class="pre">myinclude.h</span></code></p>
<p>With <code class="docutils literal notranslate"><span class="pre">--input_stream</span></code>, defines the name of the C include file that
provides definitions for <code class="docutils literal notranslate"><span class="pre">EVERPARSE_INPUT_STREAM_BASE</span></code> and its
associated functions.</p>
</li>
</ul>
</div>
<div class="section" id="alternate-mode-generating-a-makefile">
<h3>Alternate mode: generating a Makefile<a class="headerlink" href="#alternate-mode-generating-a-makefile" title="Permalink to this headline">¶</a></h3>
<p>By default, with <code class="docutils literal notranslate"><span class="pre">--batch</span></code>, given a <code class="docutils literal notranslate"><span class="pre">.3d</span></code> specification, EverParse
produces <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files by first producing <code class="docutils literal notranslate"><span class="pre">.fsti</span></code> and
<code class="docutils literal notranslate"><span class="pre">.fst</span></code> files files containing verified F* specifications and
implementations of validators, and then calling F* and KaRaMeL on each
such file to verify and extract them to C. EverParse will issue all
such calls to F* and KaRaMeL sequentially.</p>
<p>Alternatively, with <code class="docutils literal notranslate"><span class="pre">everparse.cmd</span> <span class="pre">--makefile</span> <span class="pre">gmake</span> <span class="pre">Test.3d</span></code> (on
Windows; use <code class="docutils literal notranslate"><span class="pre">./everparse.sh</span></code> on Linux), instead of producing <code class="docutils literal notranslate"><span class="pre">.c</span></code>
and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files, EverParse will take <code class="docutils literal notranslate"><span class="pre">Test.3d</span></code> and all of the
modules it depends on, and produce a GNU Makefile containing all
recipes and rules to produce <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files and all
intermediate files with proper dependencies so that the user can
leverage GNU Make parallelism for any rules that do not depend on one
another. Other build systems are supported with variations of the
<code class="docutils literal notranslate"><span class="pre">--makefile</span></code> option, as stated below.</p>
<p>The produced Makefile will make use of three variables:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">EVERPARSE_CMD</span></code>: the command to run EverParse. This variable must
contain the path and name of the EverParse executable, and any
options (<code class="docutils literal notranslate"><span class="pre">--clang_format</span></code>, etc.) useful to produce .</li>
<li><code class="docutils literal notranslate"><span class="pre">EVERPARSE_INPUT_DIR</span></code>: the path to the input files.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, all <code class="docutils literal notranslate"><span class="pre">.3d</span></code> files must be located in the same input
directory.</p>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">EVERPARSE_OUTPUT_DIR</span></code>: the path to the output files. EverParse
will append the <code class="docutils literal notranslate"><span class="pre">--odir</span></code> option appropriately.</li>
<li><code class="docutils literal notranslate"><span class="pre">CC</span></code>: the path and name of the C compiler that will be used to
compile the produced C files.</li>
<li><code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code>: options to provide to the C compiler to compile the
produced C files.</li>
</ul>
<p>The produced Makefile, by default called <code class="docutils literal notranslate"><span class="pre">EverParse.Makefile</span></code>, is
meant to be included in the main <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> of your project. On
Linux, such a typical main <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> for use with GNU Make may look
like:</p>
<p>Also valid in Makefile generation mode are the following options:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--clang_format</span></code></p>
<p>Add <code class="docutils literal notranslate"><span class="pre">.clang-format</span></code> as a dependency of generated <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code>
files, and produce a rule to generate <code class="docutils literal notranslate"><span class="pre">.clang-format</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--clang_format_use_custom_config</span></code></p>
<p>Same as <code class="docutils literal notranslate"><span class="pre">--clang_format</span></code>, but do not produce a rule to generate
<code class="docutils literal notranslate"><span class="pre">.clang-format</span></code></p>
</li>
</ul>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>

<span class="nv">EVERPARSE_CMD</span><span class="o">=</span>/path/to/everparse.sh
<span class="nv">EVERPARSE_OUTPUT_DIR</span><span class="o">=</span>obj
<span class="nv">EVERPARSE_INPUT_DIR</span><span class="o">=</span>src

<span class="nv">everparse_makefile</span><span class="o">=</span><span class="k">$(</span>EVERPARSE_OUTPUT_DIR<span class="k">)</span>/EverParse.Makefile
<span class="nv">source_files</span><span class="o">=</span><span class="k">$(</span>wildcard<span class="w"> </span><span class="k">$(</span>EVERPARSE_INPUT_DIR<span class="k">)</span>/*.3d<span class="k">)</span>

<span class="nf">$(EVERPARSE_OUTPUT_DIR)</span><span class="o">:</span>
<span class="w">	</span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$@</span>

<span class="nf">$(everparse_makefile)</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">source_files</span><span class="k">)</span> <span class="k">$(</span><span class="nv">EVERPARSE_OUTPUT_DIR</span><span class="k">)</span>
<span class="w">	</span><span class="k">$(</span>EVERPARSE_CMD<span class="k">)</span><span class="w"> </span>--makefile<span class="w"> </span>gmake<span class="w"> </span>--makefile_name<span class="w"> </span><span class="nv">$@</span><span class="w"> </span><span class="k">$(</span>source_files<span class="k">)</span>

<span class="cp">include $(everparse_makefile)</span>

<span class="nf">test</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">EVERPARSE_ALL_O_FILES</span><span class="k">)</span>

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>EVERPARSE_OUTPUT_DIR<span class="k">)</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">test</span> <span class="n">clean</span>
</pre></div>
</div>
<p>A fully commented version of that main <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> is available <a class="reference external" href="https://github.com/project-everest/everparse/blob/master/src/3d/tests/modules/Makefile">in
the EverParse repository</a>.</p>
<p>EverParse supports the following command-line options relevant to this
mode:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--makefile</span> <span class="pre">gmake</span></code>: produce a Makefile for use with GNU Make.</li>
<li><code class="docutils literal notranslate"><span class="pre">--makefile</span> <span class="pre">nmake</span></code>: produce a Makefile for use with Microsoft
NMAKE.</li>
<li><code class="docutils literal notranslate"><span class="pre">--makefile_name</span> <span class="pre">my_file_name</span></code>: the name of the produced Makefile
shall be <code class="docutils literal notranslate"><span class="pre">my_file_name</span></code> instead of the default
<code class="docutils literal notranslate"><span class="pre">EverParse.Makefile</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">--skip_o_rules</span></code>: do not output rules that would produce <code class="docutils literal notranslate"><span class="pre">.o</span></code>
files by compiling <code class="docutils literal notranslate"><span class="pre">.c</span></code> files.</li>
</ul>
</div>
<div class="section" id="alternate-mode-hash-checking">
<h3>Alternate mode: hash checking<a class="headerlink" href="#alternate-mode-hash-checking" title="Permalink to this headline">¶</a></h3>
<p>To speed up some scenarios where the user maintains a snapshot of the
generated .c and .h files to skip unnecessary verification time when
.3d files are not changed, EverParse provides an optional mechanism to
record the hash of .3d, .c and .h files and to compare them to skip
reverification and regeneration. This mechanism is disabled by
default, and has to be explicitly enabled using the <code class="docutils literal notranslate"><span class="pre">--check_hashes</span></code>
option as described below.  <strong>WARNING:</strong> this mode will weaken
verification guarantees to the probability of hash collisions!</p>
<p>If enabled, then EverParse checks the hashes of the .3d and maybe .c
and .h files (depending on the variant, as described below) and fails
if hashes do not match; no verification or regeneration is performed
at all.</p>
<p>Hashes are computed and checked using the <a class="reference external" href="https://hacl-star.github.io/HaclValeEverCrypt.html">EverCrypt</a> verified
cryptographic library, which is included in EverParse binary packages.</p>
<p>Options relevant to this mode:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--save_hashes</span></code>: save the hashes of the contents of source .3d, .c
and .h files into a .json file. This option can be added in default
mode when generating .c and .h files.</li>
<li><code class="docutils literal notranslate"><span class="pre">--check_hashes</span> <span class="pre">strong</span></code> : checks the hashes of the contents of
source .3d, .c and .h files, by reading the recorded hash from the
.json file created by <code class="docutils literal notranslate"><span class="pre">--save_hashes</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">--check_hashes</span> <span class="pre">weak</span></code> : checks the hashes of the contents of
source .3d files only, by reading the recorded hash from the .json
file created by <code class="docutils literal notranslate"><span class="pre">--save_hashes</span></code>, leaving the option for the user
to manually change the generated .c and .h files (<strong>WARNING:</strong> this
will void all verification guarantees!)</li>
<li><code class="docutils literal notranslate"><span class="pre">--check_hashes</span> <span class="pre">inplace</span></code>: same as <code class="docutils literal notranslate"><span class="pre">--check_hashes</span> <span class="pre">weak</span></code>, but
uses the hash recorded in the copyright header of the generated .c
and .h files instead of the .json file. The hash is introduced by
using the <code class="docutils literal notranslate"><span class="pre">EVERPARSEHASHES</span></code> keyword in the corresponding
<code class="docutils literal notranslate"><span class="pre">.copyright.txt</span></code> used to prepend generated .c and .h files with
copyright headers; see <a class="reference external" href="3d-lang.html#adding-copyright-notices-to-produced-c-h-files">Copyright headers</a> for
more details.</li>
<li><code class="docutils literal notranslate"><span class="pre">--check_inplace_hash</span> <span class="pre">MyFile.3d=MyFile.h</span></code>: same as
<code class="docutils literal notranslate"><span class="pre">--check_hashes</span> <span class="pre">inplace</span></code>, but instead manually specifies the pair
of the source <code class="docutils literal notranslate"><span class="pre">.3d</span></code> file and the already-generated <code class="docutils literal notranslate"><span class="pre">.h</span></code> (or
<code class="docutils literal notranslate"><span class="pre">.c</span></code>) file in which to check the hash. This option can be
specified several times to provide several such pairs to check.</li>
</ul>
</div>
<div class="section" id="alternate-mode-test-case-generation">
<h3>Alternate mode: test case generation<a class="headerlink" href="#alternate-mode-test-case-generation" title="Permalink to this headline">¶</a></h3>
<p>Given a 3d specification, EverParse can now generate positive (resp.
negative) test cases. Internally, EverParse converts the 3d
specification into a
<a class="reference external" href="https://stp.readthedocs.io/en/latest/smt-input-language.html">SMT2</a>
theory, and then asks <a class="reference external" href="https://github.com/z3prover/z3">Z3</a> for the following satisfiability question: is
there any sequence of bytes passing (resp.  failing) the parser
specification?</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Test case generation currently does not work with probes that
coerce pointer types or specialization for different pointer sizes.</p>
</div>
<p>The following options are mutually exclusive:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_test</span> <span class="pre">MyModule.my_parser</span></code></p>
<p>(requires <code class="docutils literal notranslate"><span class="pre">MyModule.3d</span></code> to be specified on the command line)
produces positive and negative test cases for <code class="docutils literal notranslate"><span class="pre">my_parser</span></code> defined
in <code class="docutils literal notranslate"><span class="pre">MyModule.3d</span></code> .</p>
<p>This option produces the following results:</p>
<ul>
<li><p class="first">a series of binary files containing the contents of each test
case. Each binary file is named as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">witness.n.POS.i.validatorname.args.dat</span></code></p>
<p>where:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">n</span></code> is the test case number</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">POS</span></code> (resp. <code class="docutils literal notranslate"><span class="pre">NEG</span></code>) indicates a positive (resp. negative) test case</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">i</span></code> is a <em>probe counter</em>: <code class="docutils literal notranslate"><span class="pre">0</span></code> corresponds to the input
buffer passed to the validator; a positive value corresponds to
the <code class="docutils literal notranslate"><span class="pre">i</span></code>-th time a <code class="docutils literal notranslate"><span class="pre">probe</span></code> 3d construct is encountered. (If
the 3d specification contains no <code class="docutils literal notranslate"><span class="pre">probe</span></code> construct, then only
the <code class="docutils literal notranslate"><span class="pre">0</span></code> file will be created for each test case.)</p>
<p>More precisely, when encountering a <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">*ptr</span> <span class="pre">probe</span>
<span class="pre">ProbeFunction(length</span> <span class="pre">=</span> <span class="pre">...,</span> <span class="pre">destination</span> <span class="pre">=</span> <span class="pre">...)</span></code> pointer field,
the binary contents for that field in a test case is the
big-endian representation of a positive 64-bit integer <code class="docutils literal notranslate"><span class="pre">i</span></code> so
that the contents of the file with probe index <code class="docutils literal notranslate"><span class="pre">i</span></code> is meant to
be passed to the validator for <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">validatorname</span></code> is the name of the validator function produced
by EverParse. It has the shape <code class="docutils literal notranslate"><span class="pre">ModuleValidateMyParser</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">args</span></code> is the sequence of the non-outparameter argument values
passed to the validator, separated by <code class="docutils literal notranslate"><span class="pre">.</span></code> ; all of those
argument values are integers.</p>
</li>
</ul>
</li>
<li><p class="first">a C test program, <code class="docutils literal notranslate"><span class="pre">testcases.c</span></code>, that produces C definitions of
the test cases, and calls to the validator with those test cases.</p>
<p>A given test case is an array of <em>layers</em>; a layer is a byte array
and its length. Layer 0 contains the byte array passed to the
validator; layer of a positive index <code class="docutils literal notranslate"><span class="pre">i</span></code> contains the byte array
passed to the validator corresponding to the <code class="docutils literal notranslate"><span class="pre">i</span></code>-th time a
<code class="docutils literal notranslate"><span class="pre">probe</span></code> pointer field is encountered.</p>
</li>
<li><p class="first">with <code class="docutils literal notranslate"><span class="pre">--batch</span></code> (set by default when using the <code class="docutils literal notranslate"><span class="pre">everparse.sh</span></code> /
<code class="docutils literal notranslate"><span class="pre">everparse.bat</span></code> script from the binary package), this option
also compiles the C test program into <code class="docutils literal notranslate"><span class="pre">test.exe</span></code> and runs it to
check whether the generated test cases are actually accepted or
rejected by the verified validator implementations for the given
3d parser specifications. Then, the test program prints on
standard output the C definitions of the test cases.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">--no_batch</span></code> to disable compilation of the C test program.</p>
</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_diff_test</span> <span class="pre">MyModule1.my_parser1,MyModule2.my_parser2</span></code></p>
<p>(requires <code class="docutils literal notranslate"><span class="pre">MyModule1.3d</span></code> and <code class="docutils literal notranslate"><span class="pre">MyModule2.3d</span></code> to be specified on
the command line) produces a set of test cases that are positive for
<code class="docutils literal notranslate"><span class="pre">my_parser1</span></code> but negative for <code class="docutils literal notranslate"><span class="pre">my_parser2</span></code>, and a set of test
cases for the converse.</p>
<p>The shape of the produced results is similar to those produced by
<code class="docutils literal notranslate"><span class="pre">--z3_test</span></code> (see above), except that the test file name also
contains the name of the second validator against which it is
negative.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If Z3 produces no test cases and instead answers <code class="docutils literal notranslate"><span class="pre">unsat</span></code> both
ways (<code class="docutils literal notranslate"><span class="pre">my_parser1</span></code> and not <code class="docutils literal notranslate"><span class="pre">my_parser2</span></code>; and <code class="docutils literal notranslate"><span class="pre">my_parser2</span></code> and
not <code class="docutils literal notranslate"><span class="pre">my_parser1</span></code>), then the two specifications are equivalent in
terms of validation: they accept the exact same inputs. However,
they do not necessarily write the same values into outparameters.</p>
</div>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--emit_smt_encoding</span></code></p>
<p>produces the SMT2 encoding corresponding to the <code class="docutils literal notranslate"><span class="pre">.3d</span></code> files passed
as argument. Such encoding is printed on standard output.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--test_checker</span> <span class="pre">MyModule.my_parser</span></code></p>
<p>(requires <code class="docutils literal notranslate"><span class="pre">MyModule.3d</span></code> to be specified on the command line)
produces a test checker executable for the given parser,
<code class="docutils literal notranslate"><span class="pre">test.exe</span></code>. The test checker takes as arguments:</p>
<ul class="simple">
<li>a binary file name containing the contents of the input buffer to
be passed to the validator</li>
<li>the non-outparameter integer argument values to be passed to the
validator</li>
</ul>
<p>The test checker executable returns exit code:</p>
<ul class="simple">
<li>0 if validation succeeds and consumes all input bytes</li>
<li>1 if validation succeeds but the validator does not consume all input bytes</li>
<li>2 if validation fails</li>
<li>3 if the input file is larger than 4 GB, or if any system error
occurs (file does not exist, read error, etc.)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The test checker executable currently does not work with 3d
specifications containing probes.</p>
</div>
</li>
</ul>
<div class="section" id="options-for-z3-test">
<h4>Options for <code class="docutils literal notranslate"><span class="pre">--z3_test</span></code><a class="headerlink" href="#options-for-z3-test" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_test_mode</span> <span class="pre">pos</span></code></p>
<p>Only produces positive test cases</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_test_mode</span> <span class="pre">neg</span></code></p>
<p>Only produces negative test cases</p>
</li>
</ul>
</div>
<div class="section" id="options-related-to-the-c-test-program">
<h4>Options related to the C test program<a class="headerlink" href="#options-related-to-the-c-test-program" title="Permalink to this headline">¶</a></h4>
<p>Unless explicitly specified otherwise, the following options can be
used with <code class="docutils literal notranslate"><span class="pre">-z3_test</span></code> or <code class="docutils literal notranslate"><span class="pre">--z3_diff_test</span></code>:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_skip_testcases_c</span></code></p>
<p>Do not produce the C test program <code class="docutils literal notranslate"><span class="pre">testcases.c</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_flight_name</span> <span class="pre">myflight</span></code></p>
<p>In the produced C test program and on its standard output, prefixes
each C test case with <code class="docutils literal notranslate"><span class="pre">witnessmyflight</span></code> instead of <code class="docutils literal notranslate"><span class="pre">witness</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_skip_c_initializers</span></code></p>
<p>Do not use C99 designated initializers (struct initializers with
field labels, of the form <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">.field</span> <span class="pre">=</span> <span class="pre">value,</span> <span class="pre">...</span> <span class="pre">}</span></code>) for test
cases. This option is needed if the code is meant to be used with a
C++ compiler in a mode older than C++20.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">-z3_use_ptr</span></code></p>
<p>In the produced C test program, use pointers rather than array
indices for probe pointer field values. The architecture-specific
binary representation of pointers will be used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option currently only works with 64-bit pointers.</p>
</div>
<p>This option does not affect the produced <code class="docutils literal notranslate"><span class="pre">*.dat</span></code> binary test
files, which will still use array indices.</p>
</li>
</ul>
</div>
<div class="section" id="options-related-to-z3-and-smt2">
<h4>Options related to Z3 and SMT2<a class="headerlink" href="#options-related-to-z3-and-smt2" title="Permalink to this headline">¶</a></h4>
<p>Unless explicitly specified otherwise, the following options can be
used with <code class="docutils literal notranslate"><span class="pre">-z3_test</span></code> or <code class="docutils literal notranslate"><span class="pre">--z3_diff_test</span></code>:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_executable</span> <span class="pre">path/to/z3.exe</span></code></p>
<p>Specify a path to the Z3 executable that should be used to generate
the test cases. This option does not affect the verification of the
generated F* files. EverParse has been tested with Z3 4.13.3 for both
test case generation and verification of the generated F* files.
<code class="docutils literal notranslate"><span class="pre">everparse.sh</span></code> / <code class="docutils literal notranslate"><span class="pre">everparse.bat</span></code> already sets
<code class="docutils literal notranslate"><span class="pre">--z3_executable</span></code> accordingly.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_options</span> <span class="pre">'option1</span> <span class="pre">...</span> <span class="pre">optionK'</span></code></p>
<p>Pass command-line options to Z3 verbatim.</p>
<p>Example: <code class="docutils literal notranslate"><span class="pre">--z3_options</span> <span class="pre">-t:1000</span></code> imposes a per-query timeout of
<code class="docutils literal notranslate"><span class="pre">1000</span></code> milliseconds.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--save_z3_transcript</span> <span class="pre">file.smt2</span></code></p>
<p>Saves the Z3 transcript (SMT2 commands sent to Z3, and response from
Z3 as comments) to the specified <code class="docutils literal notranslate"><span class="pre">file.smt2</span></code></p>
</li>
</ul>
</div>
<div class="section" id="branch-coverage-analysis">
<h4>Branch coverage analysis<a class="headerlink" href="#branch-coverage-analysis" title="Permalink to this headline">¶</a></h4>
<p>Unless explicitly specified otherwise, the following options can be
used with <code class="docutils literal notranslate"><span class="pre">-z3_test</span></code> or <code class="docutils literal notranslate"><span class="pre">--z3_diff_test</span></code>:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_branch_depth</span> <span class="pre">n</span></code></p>
<p>Ask z3 to generate test cases for all possible branches of a 3D
specification up to depth <code class="docutils literal notranslate"><span class="pre">n</span></code>, by depth-first search.  Branching
points in a 3D specification are field constraints and <code class="docutils literal notranslate"><span class="pre">casetype</span></code>;
a <em>branch</em> is a sequence of choices performed at successive
branching points. Default value for <code class="docutils literal notranslate"><span class="pre">n</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code> to not perform
branch coverage analysis.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--z3_witnesses</span> <span class="pre">n</span></code></p>
<p>If <code class="docutils literal notranslate"><span class="pre">--z3_test_mode</span></code> is specified, then this option produces <code class="docutils literal notranslate"><span class="pre">n</span></code>
test cases for each branch. Otherwise, produce <code class="docutils literal notranslate"><span class="pre">n</span></code> positive and
<code class="docutils literal notranslate"><span class="pre">n</span></code> negative tests for each branch. In both cases, <code class="docutils literal notranslate"><span class="pre">n</span></code> must be a
positive integer.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="alternate-mode-help-and-version">
<h3>Alternate mode: help and version<a class="headerlink" href="#alternate-mode-help-and-version" title="Permalink to this headline">¶</a></h3>
<p>Some options make EverParse do nothing other than show a help or
version message:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--version</span></code></p>
<p>Print the version of EverParse/3d and exit (do not process any
further options to the right, nor any files at all.)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--help</span></code></p>
<p>Show the usage message and the status of some options given so far,
and exit (do not process any further options to the right, nor any
files at all.)</p>
</li>
</ul>
</div>
</div>
<div class="section" id="language-reference">
<h2>Language Reference<a class="headerlink" href="#language-reference" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#base-types">Base types</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#structs">Structs</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#constraints">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#bitfields">Bitfields</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#constants-and-enumerations">Constants and Enumerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#parameterized-data-types">Parameterized data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#tagged-unions-or-casetype">Tagged unions or <code class="docutils literal notranslate"><span class="pre">casetype</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#arrays">Arrays</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#byte-sized-arrays">Byte-sized arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#singleton-arrays-of-variable-size">Singleton arrays of variable size</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#actions">Actions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#action-basics">Action basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#atomic-actions">Atomic actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#composing-atomic-actions-sequentially-and-conditionally">Composing atomic actions sequentially and conditionally</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#another-example">Another example</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#actions-that-always-succeed">Actions that always succeed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#restrictions">Restrictions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#alignment">Alignment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#variable-length-types">Variable-length Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#static-assertions-to-validate-alignment">Static Assertions to Validate Alignment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#explicitly-checking-3d-types-for-correspondence-with-existing-c-types">Explicitly checking 3d types for correspondence with existing C types</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#generating-code-with-for-several-compile-time-configurations">Generating code with for several compile-time configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#validating-data-with-indirections-or-pointers">Validating Data with Indirections or Pointers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#pointer-types">Pointer Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#probing-pointers-a-first-example">Probing Pointers: A first example</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#probing-multiple-indirections">Probing Multiple Indirections</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#top-level-probes">Top-level Probes</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#coercing-pointer-types">Coercing Pointer Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#multiple-probe-callbacks">Multiple Probe Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#nullable-pointers">Nullable Pointers</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#an-end-to-end-executable-example">An End-to-end Executable Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#specialization-for-different-pointer-sizes">Specialization for Different Pointer Sizes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#a-first-example">A First Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#a-first-manual-attempt">A First Manual Attempt</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#a-second-manual-attempt">A Second Manual Attempt</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#automated-specialization">Automated Specialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#first-example-in-its-entirety">First Example in its Entirety</a></li>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#what-is-proven-about-specialization">What is Proven About Specialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#an-end-to-end-executable-example-1">An End-to-end Executable Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#limitations-on-variable-length-structures">Limitations on Variable-length Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="3d-lang.html#data-dependency-for-well-formedness">Data Dependency for Well-formedness</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#and-end-to-end-example-with-variable-length-structures">And End-to-end Example with Variable-length Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#other-forms-of-specialization">Other forms of Specialization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#comments">Comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#adding-copyright-notices-to-produced-c-h-files">Adding copyright notices to produced .c/.h files</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#modular-structure-and-files">Modular structure and files</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#error-handling">Error handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#fully-worked-examples-tcp-segment-headers">Fully worked examples: TCP Segment Headers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#generated-code">Generated code</a></li>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#error-handling-1">Error handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d-lang.html#fully-worked-examples-elf-files">Fully worked examples: ELF files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3d-lang.html#integrating-elf-validator-in-existing-code">Integrating ELF validator in existing code</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
          </div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Verified efficient parsing for binary data formats" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3d-lang.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Microsoft Research.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>